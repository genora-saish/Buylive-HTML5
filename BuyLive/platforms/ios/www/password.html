<!DOCTYPE HTML>
<html>
 <head>
 <title>Profile</title>
 <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
<script src="js/cordova.js"></script>
   <script src="js/jquery-1.9.1.min.js"></script>
   <script src="js/jquery.mobile-1.3.2.js"></script>
   <script src="js/dbsql.js"></script>
    <link rel="stylesheet" type="text/css" href="css/jquery.mobile.flatui.css" />
   <style>
   .clr{
		clear: both;
		margin:0;
		padding:0;
		float:none;
	}
	
	
  .thumb {
    height: 75px;
    border: 1px solid #000;
    margin: 10px 5px 0 0;
  }
 
</style>
<script>
document.addEventListener("deviceready", onDeviceReady, false);
function onDeviceReady()
{
initDatabase();
}
 
function update_pass()
{
    
     var eml = localStorage.getItem('email');
     
     if(eml==null)
     {
         custom_alert('Please Login','Change Password');
         return false;
     }
	if($("#oldpass").val()=="")
	{
	//alert('Enter Old Password');
	custom_alert('Enter Old Password','Change Password');
	return false;
	}
	if($("#newpass").val()=="")
	{
	//alert('Enter New Password');
	custom_alert('Enter New Password','Change Password');
	return false;
	}
	if($("#conpass").val()=="")
	{
	//alert('Enter Confirm Password');
	custom_alert('Enter Confirm Password','Change Password');
	return false;
	}
	

	if($("#conpass").val() != $("#newpass").val())
	{
	//alert('Password Mismatch');
	custom_alert('Password Mismatch','Change Password');
	return false;
	}
		 var networkState = navigator.connection;

        var states = {};
        states[Connection.UNKNOWN]  = 'Unknown connection';
        states[Connection.ETHERNET] = 'Ethernet connection';
        states[Connection.WIFI]     = 'WiFi connection';
        states[Connection.CELL_2G]  = 'Cell 2G connection';
        states[Connection.CELL_3G]  = 'Cell 3G connection';
        states[Connection.CELL_4G]  = 'Cell 4G connection';
        states[Connection.NONE]     = 'No network connection';

      
  if(states[Connection.NONE] != states[networkState] )
  {
	  	txt='';
	     
	      var userid = localStorage.getItem('userid');
	      
	      txt=txt+'<?xml version="1.0" encoding="UTF-8"?><!--Sample XML file generated by XMLSpy v2012 (http://www.altova.com)--><customer:customer xsi:schemaLocation="http://schema.ayenda.com/smartBuy/customer customer.xsd" xmlns:ns2="http://schema.ayenda.com/smartBuy/credential" xmlns:customer="http://schema.ayenda.com/smartBuy/customer" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><customerID>'+userid+'</customerID><ns2:credential><email>'+eml+'</email><password>'+$("#newpass").val()+'</password><oldPassword>'+$("#oldpass").val()+'</oldPassword><type>CUSTOMER</type></ns2:credential></customer:customer>';
		  
		
	
	  
			
			

			console.log(txt);

			$.ajax({
			    url: 'http://buyzenga.com:7003/BPL/rest/CouponRESTProxy/updatePassword',
			    type: 'POST',
			   	datatype : 'application/xml',
			    data: txt,
			    contentType: 'application/xml',
			   
			    success: function (result) {
			    	if(result==true)
			    	{
			    		
			    		//alert('Password updated successfully');
			    		custom_alert('Password updated successfully','Change Password');
						location.href="settings.html";
			    	}
			    	else
		        	{
		        	//alert('Failed to update the password.Please try again');
		        	custom_alert('Failed to update the password.Please try again','Change Password');
		        	return false;
		        	}
			
	
			 	},
			    error: function (jqXHR, tranStatus, errorThrown) {
			    
			        if(jqXHR.responseText=='true')
			        	{
			        	custom_alert('Password updated successfully','Change Password');
						location.href="settings.html";
			        	}
			        else
			        	{
			        	custom_alert('Failed to update the password.Please try again','Change Password');
			        	return false;
			        	}
			    }
			});
			
			}
else
{
//alert('You are currently offline');
custom_alert('You are currently offline','Change Password');
}
}
	
  

</script>
</head>
	<body>
		<div data-role="page" data-theme="j">
		<div id="loginHeader" data-role="header" class="headerheight" data-theme="h">
			<a href="camera.html" rel="external" style="margin-top:-15px;" class="ui-btn-left"><div style="width:40px; height:44px;"><img class="imagesize" style="position:relative; top:17px;width:18px;height:18px;" src="images/arrow_left.png"/></div></a>	
			<h2>Change Password</h2>
			<a href="" rel="external" style="margin-top:-15px;" class="ui-btn-right"><div style="width:40px; height:44px;"><img class="imagesize" style="position:relative; top:17px;width:18px;height:18px;" src="images/arrow_right.png"/></div></a>	
			
				</div>
		<div data-role="content">
			
			<div id="loginDiv" class="divcolor ">
		
			
				<label class="blacktext" style="padding-left:5px;" for="oldpass">Old Password</label>
				<input  style="border:none" type="password" name="oldpass" autocapitalize="off" id="oldpass" value="" style="font-size:14px;font-style:italic" placeholder="*********">
				<label class="blacktext" style="padding-left:5px;" for="newpass">New Password</label>
				<input  style="border:none" type="password" name="newpass" autocapitalize="off" id="newpass" value="" style="font-size:14px;font-style:italic" placeholder="*********">
				<label class="blacktext" style="padding-left:5px;" for="conpass">confirm Password</label>
				<input  style="border:none" type="password" name="conpass" autocapitalize="off" id="conpass" value="" style="font-size:14px;font-style:italic" placeholder="*********">
				
				
				</div>
				<div class="clr"></div>
				<br>
				
				<div  style="min-width:30px;float:left;width:40%;padding-left:5%">	
					 <a href="#" rel="external" class="buttoncolor" style="padding-right:5px;" data-role="button" onclick="update_pass()" data-theme="i">Submit</a>
				</div>
				
				<div style="min-width:30px;float:right;width:40%;padding-right:5%">
					<a href="camera.html" rel="external" class="buttoncolor" data-role="button" data-theme="i">Cancel</a>
				</div>
				<div class="clr"></div>
			</div>
		</div>
		</div><!-- /page -->
		</body>


   
 	
  </html>
