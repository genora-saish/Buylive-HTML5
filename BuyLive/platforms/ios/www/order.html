<!DOCTYPE HTML>
<html>
 <head>
   <title>Buy Live</title>
   <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
   <link rel="stylesheet" type="text/css" href="css/jquery.mobile.flatui.css" />
   <script src="cordova.js"></script> 
   <script src="js/app.js" type="text/javascript"></script>
   <script src="js/jquery-1.9.1.min.js"></script>
   <script src="js/jquery.mobile-1.3.2.js"></script>
    <script src="js/function.js"></script>
    <script src="js/dbsql.js" type="text/javascript"></script>
	<script type="text/javascript" charset="utf-8" src="js/order_historyPlugin.js"></script>
	<script type="text/javascript" charset="utf-8" src="js/order_historyPlugin1.js"></script>
	 <script type="text/javascript" charset="utf-8" src="js/order_historyPlugin2.js"></script>  

   <style>
   .clr{
		clear: both;
		margin:0;
		padding:0;
		float:none;
	}
	
	.ui-page .ui-content .ui-btn.my-btn .ui-btn-inner {
    color      : green;
    background : red;
	}
	
	.spanheight{
 
  height:18px;
 // background-color:yellow;
  float:left;
  width:70px;
}
.divheight
{
height:20px;width:100%;
}
   .storeAddPopUpList
	{
	float:left;width:80%;padding-left:5px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;margin-top:-3px;position: relative;left: 5px;
	}

	

	@media all and (max-width: 100000px) and (min-width:436px){

	  .storeAddPopUpList{
	float:left;width:80%;padding-left:5px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;margin-top:6px;position: relative;left: 5px;
	}
	}
	</style>
	<script type="text/javascript">
	var count_order = new Array();
	var count_item = new Array();
	document.addEventListener("deviceready", onDeviceReady, false);
	var path;
	var path_arr;
	function onDeviceReady()
	{
		
		initDatabase();
		var userid= localStorage.getItem('userid');
	  
	    if(userid==null)
	    {
	    	  custom_alert('Please login','OrderPage');
			  location.href="login.html";
	    	  return false;
	    }
		
		change_quantity();
		window.requestFileSystem  = window.requestFileSystem || window.webkitRequestFileSystem;
		window.requestFileSystem(LocalFileSystem.TEMPORARY, 0, gotFS, fail);
		
		sen_cust_id();
		
		
	}
	
	function fail() 
	{
		
	}
	
	function gotFS(fileSystem) {



    



    

    window.rootFS = fileSystem.root;

    path  = fileSystem.root.fullPath;

    

    

    if( device.platform == "Android")

    {

		path_arr  = path.split('///');

	    path_arr ='/'+path_arr[1];


    }

    if( device.platform == "iOS")

    {

        path_arr = path.split('/');

        var path_len = path_arr.length;

        

        path_arr[path_len - 1] = 'Library/Caches';

        path_arr = path_arr.join('/');

    }

	}
	
	function callNativePlugin( returnSuccess ) 
	 {
      
         order_historyPlugin.callNativeFunction( nativePluginResultHandler, nativePluginErrorHandler, returnSuccess );
         
     }
	 
    var counter_size = 0;
	function nativePluginResultHandler (result) 
	{
        
        var resultreceived=result.split(',');
		var storeid	= localStorage.getItem('menuid');
	
        get_recent_orderhistory();
		
	}

	function nativePluginErrorHandler (error) 
	{
		

	

	}
    
    function callNativePlugin1( returnSuccess1 )
    {
        
        order_historyPlugin1.callNativeFunction( nativePluginResultHandler1, nativePluginErrorHandler1, returnSuccess1 );
        
    }
    
    
	function nativePluginResultHandler1 (result)
	{
        
        
        var resultreceived1=result.split(',');
		

		get_recent_orderhistoryold();
        
		
	}
    
	function nativePluginErrorHandler1 (error)
	{
		
		
		
		
        
        
        
        
        
	}
    
    
    
     function callNativePlugin_all( returnSuccessall )
     {
         
          order_historyPlugin2.callNativeFunction( nativePluginResultHandlerall, nativePluginErrorHandlerall, returnSuccessall );
         
     }
    
    
	function nativePluginResultHandlerall (result)
	{
        
        
		
        
		
	}
    
	function nativePluginErrorHandlerall (error)
	{
		

        
        
	}

	function checkConnection() {
	    var networkState = navigator.connection.type;

	    var states = {};
	    states[Connection.UNKNOWN]  = 'Unknown connection';
	    states[Connection.ETHERNET] = 'Ethernet connection';
	    states[Connection.WIFI]     = 'WiFi connection';
	    states[Connection.CELL_2G]  = 'Cell 2G connection';
	    states[Connection.CELL_3G]  = 'Cell 3G connection';
	    states[Connection.CELL_4G]  = 'Cell 4G connection';
	    states[Connection.NONE]     = 'No network connection';

	    
	    
	  if(states[Connection.NONE] != states[networkState] )
	{
	return 'true';
	}
	else
	{
	return 'false';
	}

	}
	

function sen_cust_id()

	 {

	 $('#loadTry').popup("open");
	$("#loadTry").popup({dismissible:false});
	 
	 var conn = checkConnection();

	     if(conn ='true')

	    	 {
	
var userID = localStorage.getItem('userid');

		
	 $.ajax({

	  url: 'http://buyzenga.com:7003/BPL/rest/CouponRESTProxy/retrieveCustomerOrders',

	  type: 'POST',

	  datatype : 'application/xml',

	  data: userID,

	  contentType: 'application/xml',



	  success: function (result) {


	 
	  del_cust_store();
	  del_cust_order();
	  del_cust_item();
	 var orderitem=0;
	 var countitem=0;
    var checkcount=1;
    var checkcount2=0;
	var response_val = $(result).find("store").size();
	localStorage.setItem('storesize',response_val);
	var count=0;
    localStorage.setItem('itemsize1',$(result).find("item").size());
    var image_array1= new Array();
	
	 if(response_val!= 0)
		 {
		localStorage.setItem('size',$(result).find("store").size());
		
		for(var i=0;i<response_val;i++)
		{
			var val =  $(result).find("store")[i];
		
		
		
			insert_cust_store(userID,$(val).find("storeID").text(),userID,$(val).find("storeName").text(),$(val).find("imageURL").text());
		
		 
			 var response_val1 = $(val).find("order").size();
			
				if(response_val1!= 0)
				{
					
					for(var j=0;j<response_val1;j++)
					{
						var val1= $(val).find("order")[j];
						
						insert_cust_order($(val).find("storeID").text(),$(val1).find("order_id").text(),$(val1).find("tax").text(),$(val1).find("sub_total").text(),$(val1).find("total").text(),$(val1).find("create_date").text(),$(val1).find("status").text());
						
						 var response_val2 = $(val1).find("item").size();
						 
						  
						if(response_val2!= 0)
						{
							
							for(var k=0;k<response_val2;k++)
							{
								
								var val2=$(val1).find("item")[k];
								
								insert_cust_item($(val1).find("order_id").text(),$(val2).find("itemID").text(),$(val2).find("itemName").text(),$(val2).find("itemDescription").text(),$(val2).children("imageURL").text(),$(val2).find("price").text(),$(val2).find("qty").text(),$(val2).find("taxRate").text(),checkcount);
            
            

            image_array1[checkcount2]=$(val2).children("imageURL").text();
            
            var getitemsize1=localStorage.getItem('itemsize1');
           
          checkcount2++;
            if(checkcount2==getitemsize1)
            {
                console.log("callNativePlugin");
           
           // callNativePlugin(image_array1);
            }
             
							
							}
						
						
						
						}						
					
					
					
					
					
					
					
					
					
					}
					
				}
		
		
		count++;
		
		
		
	
            
		}
		
		
		
		
		
		
		
           
		 }
		 
		
	 else
		 {
		 $('#loadTry').popup("close");
		 custom_alert('No order history available','order');
		 location.href="shopping.html";
		 
		 }
	
		
	
		 
		
	  },
	  
	    error: function (jqXHR, tranStatus, errorThrown) {

	     custom_alert('There was an error connecting to the service.Please try again','order');
			$('#loadTry').popup("close");
	  }

	 });



	 }

	     else

	    	 {

	    	 alert('You are currently offline');
			 $('#loadTry').popup("close");
	      

	    	 }

			 
			 
	 }











	
	
	
	
	function hideMeGroceries()
	 {
	 
	var id = document.getElementById('firstStore');
	
	
	
	 if(id.style.display =="block")
	 {
		id.style.display = "none";
	 
	 }
	 else if(id.style.display =="none")
	 {
	 	id.style.display = "block";
	 }
	
	}

	function hideMeRestaurant()
	 {
	 
	var id = document.getElementById('firstRestaurant');
	
	
	
	 if(id.style.display =="block")
	 {
		id.style.display = "none";
	 
	 }
	 else if(id.style.display =="none")
	 {
	 	id.style.display = "block";
	 }
	
}


	 $(document).ready(function(){
			$(window).bind('resize', function () {
			  
			 
			   var divWidth = $('#outer').width();
			   var useDivWidth= divWidth-80;
			   var radioButtonWidth=0.25*useDivWidth;
			   var searchBar=0.5*useDivWidth;


			    
			   	
			   
				var divWidthq = $('#outdiv').width();
			   var useDivWidthq= divWidthq-53;
			  
			   var searchBarq=0.5*useDivWidthq;	
			  
			   
			     $('#radioCat').css({'width':radioButtonWidth});
			     $('#radioName').css({'width':radioButtonWidth});
			     $('#searchBar').css({'width':searchBar});
					
			   
			   

			}).trigger('resize');
		});

	</script>
	



 </head>
 <body>
 	<div data-role="page" id="#buyNew-page" data-theme="j">

	    <div id="loginHeader" data-role="header" data-position="fixed"  data-tap-toggle="false" class="headerheight" data-theme="h">
			<a href="shopping.html" rel="external" style="margin-top:-15px;" class="ui-btn-left"><div style="width:40px; height:44px;"><img class="imagesize" style="position:relative; top:17px;width:18px;height:18px;" src="images/arrow_left.png"/></div></a>	
			<h1>Order History</h1>
			<a href="#" rel="external" style="margin-top:-15px;" class="ui-btn-right"><div style="width:40px; height:44px;"><img class="imagesize" style="position:relative; top:17px;width:18px;height:18px;" src="images/arrow_right.png"/></div></a>	
			
		</div><!-- /header -->



		<div data-role="content">
			
			   <div id="outer">

			   		<div  id="radioCat" style="float:left">
			   			<div style="float:left;width:100%">
			   				<label style="font-weight:normal;min-width:55px;border:1px solid #ff9000;" id="lblCat">
					        <input  type="radio" name="category" id="catergory;" value="0" onclick="demo(this.value);get_recent_orderhistory1()" checked>Recent
					   		 </label>
			   			</div>
			   		</div>

			   		<div style="float:left;width:10px;height:43px;">   </div>

			   		<div id="radioName" style="float:left">
			   			<div style="float:left;width:100%">
			   				<label style="font-weight:normal;min-width:70px;" id="lblCat1">
					      	<input type="radio" name="category" id="category1" value="1" onclick="demo(this.value);get_cust_orderhistory()" >Confirmed
					    	</label>
			   			</div>
			   		</div>

			   		<div style="float:left;width:35px;height:43px;">   </div>
			   		
			   		<div id="searchBar" style="float:left;">
			   			<input type="text" style="border:none" name="search" id="search" value="" placeholder="Search" onkeyup="changeSearch(this.id);">
			   		</div>
			   		
			   		<div style="float:left;width:30px;height:30px;">
			   			<img id="searchIcon" style="background-color:white;border:1px solid #e5e5e5;height:25.5px;position:relative;top:9px;left:2px;float:right;" src="images/search_grey.png" onclick="search_orderhistory()"/>
			   		</div>
			  	    <div class="clr"></div>
			
			   </div>
			
			<div class="clr"></div>
			

			<div id="display_id"> </div>
            <div id="display_id1"> </div>


			<div data-role="popup" id="transitionExampl" class="ui-content" data-theme="d" style="border:1px solid #007aff">
  									 
			</div>
			<div id="loadTry" data-role="popup" data-overlay-theme="a" class="ui-content">
                     <img  src="images/ajax-loader.gif"/>
			</div>
		</div><!-- /content -->

		<div data-role="footer" data-id="footer" data-position="fixed" data-theme="h">
			<div data-role="navbar">
				<ul>
					<li><a id="home" href="homepage.html" rel="external" data-icon="home-blue" class="ui-state-persist"></a></li>
					<!--<li><a id="basket" href="shopping.html" rel="external" data-icon="basket-blue" class="ui-state-persist bluetext"></a></li>-->
					<li><div id="total_count" style="background-color:#ff9000;display:inline-block;margin-left:58%;margin-top:2%;color:black;text-align:center;z-index:2000;position:relative;font-size:12px;"></div><a id="basket" href="shopping.html" rel="external" data-icon="basket-blue" class="ui-state-persist bluetext" style="vertical-align: middle;margin-top:-22px"></a></li>
					<li><a id="list" href="menu.html" rel="external" data-icon="list-blue" class="ui-state-persist bluetext"></a></li>
					
				</ul>
			</div><!-- /navbar -->
		</div><!-- /footer -->
 

		
	</div><!-- /page -->
	<script src="js/function.js"></script>
	<script>
		function changeFavImage(){

				
			if(document.getElementById('favStatus').value=="0"){
				
				document.getElementById('favImage').src="images/heart_orange.png";
				document.getElementById('favStatus').value="1";
			}
			else if(document.getElementById('favStatus').value=="1")
			{
				document.getElementById('favImage').src="images/heart_blue.png";
				document.getElementById('favStatus').value="0";

			}
		}

		function changeFavImage0(){

				
			if(document.getElementById('favStatus0').value=="0"){
				
				document.getElementById('favImage0').src="images/heart_orange.png";
				document.getElementById('favStatus0').value="1";
			}
			else if(document.getElementById('favStatus0').value=="1")
			{
				document.getElementById('favImage0').src="images/heart_blue.png";
				document.getElementById('favStatus0').value="0";

			}
		}

		function changeFavImage1(){

				
			if(document.getElementById('favStatus1').value=="0"){
				
				document.getElementById('favImage1').src="images/heart_orange.png";
				document.getElementById('favStatus1').value="1";
			}
			else if(document.getElementById('favStatus1').value=="1")
			{
				document.getElementById('favImage1').src="images/heart_blue.png";
				document.getElementById('favStatus1').value="0";

			}
		}

		function changeFavImage2(){

				
			if(document.getElementById('favStatus2').value=="0"){
				
				document.getElementById('favImage2').src="images/heart_orange.png";
				document.getElementById('favStatus2').value="1";
			}
			else if(document.getElementById('favStatus2').value=="1")
			{
				document.getElementById('favImage2').src="images/heart_blue.png";
				document.getElementById('favStatus2').value="0";

			}
		}

		function changeFavImage_(){

				
			if(document.getElementById('favStatus_').value=="0"){
				
				document.getElementById('favImage_').src="images/heart_orange.png";
				document.getElementById('favStatus_').value="1";
			}
			else if(document.getElementById('favStatus_').value=="1")
			{
				document.getElementById('favImage_').src="images/heart_blue.png";
				document.getElementById('favStatus_').value="0";

			}
		}

		function changeFavImage_0(){

				
			if(document.getElementById('favStatus_0').value=="0"){
				
				document.getElementById('favImage_0').src="images/heart_orange.png";
				document.getElementById('favStatus_0').value="1";
			}
			else if(document.getElementById('favStatus_0').value=="1")
			{
				document.getElementById('favImage_0').src="images/heart_blue.png";
				document.getElementById('favStatus_0').value="0";

			}
		}

		function changeFavImage_1(){

				
			if(document.getElementById('favStatus_1').value=="0"){
				
				document.getElementById('favImage_1').src="images/heart_orange.png";
				document.getElementById('favStatus_1').value="1";
			}
			else if(document.getElementById('favStatus_1').value=="1")
			{
				document.getElementById('favImage_1').src="images/heart_blue.png";
				document.getElementById('favStatus_1').value="0";

			}
		}

		function changeFavImage_2(){

				
			if(document.getElementById('favStatus_2').value=="0"){
				
				document.getElementById('favImage_2').src="images/heart_orange.png";
				document.getElementById('favStatus_2').value="1";
			}
			else if(document.getElementById('favStatus_2').value=="1")
			{
				document.getElementById('favImage_2').src="images/heart_blue.png";
				document.getElementById('favStatus_2').value="0";

			}
		}

		function demo(value){
			if(value==0)
			{

				document.getElementById('lblCat').style.border="1px solid #ff9000";
				document.getElementById('lblCat1').style.border="1px solid #e5e5e5";
			}
			else if(value==1)
			{

				document.getElementById('lblCat1').style.border="1px solid #ff9000";
				document.getElementById('lblCat').style.border="1px solid #e5e5e5";
			}
		}


		function changeSearch(s)
		{
			
			if(document.getElementById(s).value.length>=1)
			{

				
				document.getElementById('searchIcon').src="images/search_orange.png";
				document.getElementById('searchIcon').style.border="1px solid #ff9000";
			}
			else
			{
				document.getElementById('searchIcon').src="images/search_grey.png";
				document.getElementById('searchIcon').style.border="1px solid #e5e5e5";
				get_recent_orderhistory1();
			}
		}
		
		
		function change_quantity()
		{
		var count=0;
		var userid=localStorage.getItem('userid');
       
		BUYDEMO.transaction(function(tx) {
		tx.executeSql('SELECT * FROM customer_items_details inner join customer_items on customer_items.ID=customer_items_details.mainid where customer_items.customerid="'+userid+'"', [], function (tx, results) {
		var len=results.rows.length;
            
			for(var j=0;j<len;j++)
			{
			 var resultres = results.rows.item(j);
			// alert(resultres.quantity);
			 count=count+resultres.quantity;
			
			
			
			}
                    
			if(count<10)
			{
					$('#total_count').css({'-moz-border-radius' : '50%'});
					$('#total_count').css({'-webkit-border-radius' : '50%'});
					$('#total_count').css({'border-radius' : '50%'});
					$('#total_count').css({'width' : '16px'});
					$('#total_count').css({'height' : '16px'});
			}
			else if(count>9 && count<100)
			{
					$('#total_count').css({'-moz-border-radius' : '50%'});
					$('#total_count').css({'-webkit-border-radius' : '50%'});
					$('#total_count').css({'border-radius' : '50%'});
					$('#total_count').css({'width' : '20px'});
					$('#total_count').css({'height' : '16px'});
			}
			else if(count>99 && count<1000)
			{
					$('#total_count').css({'-moz-border-radius' : '50%'});
					$('#total_count').css({'-webkit-border-radius' : '50%'});
					$('#total_count').css({'border-radius' : '50%'});
					$('#total_count').css({'width' : '25px'});
					$('#total_count').css({'height' : '16px'});
			}
			else
			{
					$('#total_count').css({'-moz-border-radius' : '50%'});
					$('#total_count').css({'-webkit-border-radius' : '50%'});
					$('#total_count').css({'border-radius' : '50%'});
					$('#total_count').css({'width' : '30px'});
					$('#total_count').css({'height' : '16px'});
			}
			
			 document.getElementById('total_count').innerHTML =count;
		 });
		
		});
		}
		
		var text;
		var text1;
		
		function search_orderhistory()
		{
			if(document.getElementById('search').value.length==0)
			{
			 
			 custom_alert('Search cannot be blank','Order');
			
			 return false;
			}
			$('#loadTry').popup("open");
			$("#loadTry").popup({dismissible:false});
			var userID = localStorage.getItem('userid');
			
			text='';
			 document.getElementById('display_id').innerHTML = "";
             document.getElementById('display_id1').innerHTML = "";
			 BUYDEMO.transaction(function(tx) {
			
			
			
			var t=0;
			var s=0;
			
				
				 tx.executeSql('SELECT customer_ordered_stores.*,customer_orders.*,customer_orders_items.*,GROUP_CONCAT(customer_orders_items.itemName) as itname,GROUP_CONCAT(customer_orders_items.price) as itprice,GROUP_CONCAT(customer_orders_items.quantity) as itqty,GROUP_CONCAT(customer_orders_items.taxRate) as ittax,GROUP_CONCAT(customer_orders_items.imageURL) as imgurl FROM customer_ordered_stores inner join customer_orders on customer_ordered_stores.storeid=customer_orders.mainstoreid inner join customer_orders_items on customer_orders_items.mainorderid=customer_orders.orderid where customer_ordered_stores.storename LIKE "'+$("#search").val()+'%" or customer_orders_items.itemName LIKE "'+$("#search").val()+'%" and customer_ordered_stores.customerid="'+userID+'" group by customer_orders.orderid', [], function (tx, results1) {
				 var len1 = results1.rows.length;
				
				 
				 if(len1=='0')
				  {
					 document.getElementById('display_id').innerHTML = "";
                     document.getElementById('display_id1').innerHTML = "";
					 text = text +'<div id="" class="divcolor" style="padding: 20px 20px; display: block; position: relative; top: 15px; border: 6px solid #e5e5e5">';
					 text = text +'<p>No results available</p>';
					 text = text +'</div>';
					 document.getElementById('display_id').innerHTML = text;
					 $('#loadTry').popup("close");
				  }
			   	 else
				 {
				 var result = results1.rows.item(0);
					 
				text = text + '<div data-role="collapsible" id="test-collapsible1'+result.storeid+'" data-mini="true" data-theme="k" data-content-theme="i" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d" data-inline="true" style="position:relative;top:-10px;">';
			    text = text + '<h4 class="bluetext" style="background-color:#e5e5e5;" data-role="button"  onclick="del_orderhistory_div('+result.storeid+');" data-inline="true" >'+result.storename+'('+len1+')</h4>';
				
				
				 for(var x=0;x<len1;x++)
				 {
				 var result = results1.rows.item(x);
				
				 
				 var splitdate=(result.created_date).split("T");
				
			    text = text + '<ul data-role="listview">';
			    
			        text = text + '<li  data-icon="arrow-r2" style="border:5px solid #e5e5e5;padding-left:10px;padding-top: 2px;">';

			        	text = text + '<div id="outdiv">';
			        		text = text + '<div  id="inn_div" style="padding-left:0px;float:left;padding-top:20px">';
							
									text = text + '<label class="blacktext" style="font-weight:normal;font-size:14px;font-family:Roboto">';
								text = text + '<table style="position: relative;top: -15px;">';
									text = text + '<tr>';
										text = text + '<td >Order No:</td>';
										text = text + '<td class="orangetextnavbar">'+result.orderid+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Date:</td>';
										text = text + '<td  class="orangetextnavbar">'+splitdate[0]+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Tax:</td>';
										text = text + '<td class="orangetextnavbar">'+result.tax+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Total</td>';
										text = text + '<td class="orangetextnavbar">$ '+result.total+'</td>';
									text = text + '</tr>';
								text = text + '</table>';
							text = text + '</label>';
				    text = text + '</div>';
					
					
					text = text + '<div>';
					if(result.status=='COMPLETE')
					{
					text = text + '<div id="inn_con'+x+'" style="float:right;position:relative;right:-6px;top:12px"><label style="position:relative;right:10px;top:-3px;font-size:14px;" class="lab">Confirmed?</label><img style=" top:6px; border:1px solid #ff9000;" width="15px" height="15px" src="images/tick_.png"/>';
					text = text + '</div>';
					}
					
			        	
			        		
			        		text = text + '</div>';
					text = text + '<div class="clr"></div>';		
						
					var splitnameinner=(result.itname).split(",");
				
				 var splitpriceinner=(result.itprice).split(",");
				  var splitquantityinner=(result.itqty).split(",");
				  var splittaxinner=(result.ittax).split(",");
					
				  if(!result.imgurl)
				  {
				  
				  }
				  else
				  {
					var splitimage=(result.imgurl).split(",");
				  }
					
					for(var k=0;k<splitnameinner.length;k++)
					{
					
							var total =(splitpriceinner[k] * splitquantityinner[k])*100/100;
					
							var itemtax=((((splittaxinner[k] * total)/100)*100)/100).toFixed(2);
							var itemtotal= (((parseFloat(total) + parseFloat(itemtax))*100)/100).toFixed(2);
							
							 var store_url = splitimage[k].split('/');
							var store_len = store_url.length;
							var store_img = store_url[store_len - 1]; 
							
							
			        		text = text + '<div class="clr"></div>';
			        		text = text + '<div style="left:10px;float:left;" >';
			        		text = text + '<img style="width:80px; height:80px;" src="'+path_arr+'/'+store_img+'" />';
			        		text = text + '</div>';
			        		text = text + '<div id="storeAddress" style="position: relative;left:5px;padding-left:15px;float:left;width:60%;">';
									text = text + '<div  style="float:left;padding-top:1px;width:150px;line-height:25px;white-space:nowrap;margin-top:-15px;">';
											text = text + '<span id="storeRestaurant'+k+'" class="storeAddPopUpList" onclick="StoreAddressPopUp(this.id);" style="white-space:nowrap;">';
										
										text = text + '<span class="lab" style="position:relative;left:-5px;top:-2px;">'+splitnameinner[k]+'</span>';
										text = text + '</span>';
										text = text + '</div>';
										text = text +'<div class="clr"></div>';	
									text = text + '<label class="blacktext" style="font-weight:normal;font-size:14px;font-family:Roboto;">';
										text = text + '<div style="position: relative;top: -8px;">';
										
											text = text + '<div class="divheight">';
												text = text + '<div class="spanheight" style="width:65px;">Unit Price:</div>';
												text = text + '<div class="orangetextnavbar spanheight" style="">$ '+splitpriceinner[k]+'</div>';
											text = text + '</div>';
											text = text + '<div class="clr"></div>';
											text = text + '<div class="divheight">';
												text = text + '<div class="spanheight" style="width:65px;">Qty:</div>';
												text = text + '<div class="orangetextnavbar spanheight" style="">'+splitquantityinner[k]+'</div>';
											text = text + '</div>';
											text = text + '<div class="clr"></div>';
											text = text + '<div class="divheight">';
												text = text + '<div class="spanheight" style="width:65px;">Tax:</div>';
												text = text + '<div class="orangetextnavbar spanheight" style="">'+itemtax+'</div>';
											text = text + '</div>';
											text = text + '<div class="clr"></div>';
											text = text + '<div class="divheight">';
												text = text + '<div class="spanheight" style="width:65px;">Total:</div>';
												text = text + '<div class="orangetextnavbar spanheight" style="">$ '+itemtotal+'</div>';
											text = text + '</div>';
											text = text + '<div class="clr"></div>';
										text = text + '</div>';
									text = text + '</label>';
						   		text = text + '</div>';
							text = text + '</div>';
			        	 text = text + '<div class="clr">';
						$('#loadTry').popup("close");
			        
			        }
					//t++;
			      text = text + '</div>';  
				 text = text + '</li>';
			    text = text + '</ul>';
				}
			text = text + '</div>';

			
			
			text = text + '<div id="divhistory'+result.storeid+'" class="divcolor" style="padding:20px 10px; display:block;position: relative;top: -18px;border-top: 6px solid #e5e5e5">';
			text = text + '<div id="outdiv">';
			
			
			
			        		text = text + '<div  id="inn_div" style="padding-left:0px;float:left;padding-top:4px">';
							var splitdate=(result.created_date).split("T");
								text = text + '<label class="blacktext" style="font-weight:normal;font-size:14px;font-family:Roboto">';
								text = text + '<table style="position: relative;top: -15px;">';
									text = text + '<tr>';
										text = text + '<td >Order No:</td>';
										text = text + '<td class="orangetextnavbar">'+result.orderid+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Date:</td>';
										text = text + '<td class="orangetextnavbar">'+splitdate[0]+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Tax:</td>';
										text = text + '<td class="orangetextnavbar">'+result.tax+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Total</td>';
										text = text + '<td class="orangetextnavbar">$ '+result.total+'</td>';
									text = text + '</tr>';
								text = text + '</table>';
							text = text + '</label>';
				   text = text + '</div>';
				   
			
					if(result.status=='COMPLETE')
					{
					text = text + '<div id="inn_con" class="divcolor" style="float:right;position:relative;right:-8px;top:-9px;width:80px;"><label style="position:relative;right:8px;font-size:14px;float:left;margin-left:-15px;margin-top:-15px;width:75px;height:20px;" class="lab">Confirmed?</label><img style="float:left;margin-top:-14px;border:1px solid #ff9000;vertical-align: middle;" width="15px" height="15px" src="images/tick_.png"/>';
					text = text + '</div>';
					}
			        text = text + '<div class="clr"></div>';	
			       	text = text + '<div id="div_items'+result.storeid+'"></div>';	
			       
				
				 var splitname=(result.itname).split(",");
				
				 var splitprice=(result.itprice).split(",");
				  var splitquantity=(result.itqty).split(",");
				  var splittax=(result.ittax).split(",");
				 
				  if(!result.imgurl)
				  {
				  
				  }
				  else
				  {
					var splitimage=(result.imgurl).split(",");
				  }
				  
				   for(var j=0;j<splitname.length;j++)
					{
					
					var total =(splitprice[j] * splitquantity[j])*100/100;
					 var itemtax=((((splittax[j] * total)/100)*100)/100).toFixed(2);
					 var itemtotal= (((parseFloat(total) + parseFloat(itemtax))*100)/100).toFixed(2);
					 
					var store_url = splitimage[j].split('/');
					var store_len = store_url.length;
					var store_img = store_url[store_len - 1]; 
					
					
			        		 text = text + '<div class="clr"></div>';
			        		text = text + '<div style="float:left;" >';
			        		text = text + '<img style="width:80px; height:80px;" src="'+path_arr+'/'+store_img+'" />';
			        		text = text + '</div>';
			        		text = text + '<div  id="storeAddress" style="float:left;width:60%;padding-left:15px;position:relative;">';
								text = text + '<div  style="float:left;padding-top:2px;width:150px;line-height:35px;white-space:nowrap;margin-top:-13px;">';
											text = text + '<span id="storeRestaurant1'+j+'" class="storeAddPopUpList" onclick="StoreAddressPopUp(this.id);" style="white-space:nowrap;">';
										
										text = text + '<span class="lab" style="position:relative;left:-5px;top:-2px;">'+splitname[j]+'</span>';
										text = text + '</span>';
										text = text + '</div>';
										text = text +'<div class="clr"></div>';	
									text = text + '<label class="blacktext" style="font-weight:normal;font-size:14px;font-family:Roboto;">';
										text = text + '<table style="position: relative;top: -8px;">';
										
											text = text + '<tr>';
												text = text + '<td >Unit Price:</td>';
												text = text + '<td class="orangetextnavbar">$ '+splitprice[j]+'</td>';
											text = text + '</tr>';
											text = text + '<tr>';
												text = text + '<td>Qty:</td>';
												text = text + '<td class="orangetextnavbar">'+splitquantity[j]+'</td>';
											text = text + '</tr>';
											text = text + '<tr>';
												text = text + '<td>Tax:</td>';
												text = text + '<td class="orangetextnavbar">'+itemtax+'</td>';
											text = text + '</tr>';
											text = text + '<tr>';
												text = text + '<td>Total:</td>';
												text = text + '<td class="orangetextnavbar">$ '+itemtotal+'</td>';
											text = text + '</tr>';
										text = text + '</table>';
									text = text + '</label>';
						   		text = text + '</div>';
			        	text = text + '<div class="clr"></div>';
						
					}
					
					
				text = text + '</div>';
				text = text + '</div>';
				text = text + '<hr/>';
				setTimeout(function(){display_div()},1000);
				}
				});
				
				
				});
			
		
		}
		
		
		function get_cust_orderhistory()
		{
            text='';
            document.getElementById('display_id1').innerHTML = "";
            document.getElementById('display_id').innerHTML = "";
            
            $('#loadTry').popup("open");
			$("#loadTry").popup({dismissible:false});
			
			var userID = localStorage.getItem('userid');
			
			 BUYDEMO.transaction(function(tx) {
			 tx.executeSql("SELECT * FROM customer_ordered_stores where customer_ordered_stores.customerid='"+userID+"'", [], function (tx, results) {
			var len = results.rows.length;
			
			
			if(len=='0')
			{
                     document.getElementById('display_id1').innerHTML = "";
					 document.getElementById('display_id').innerHTML = "";
					 text = text +'<div id="" class="divcolor" style="padding: 20px 20px; display: block; position: relative; top: -5px; border: 6px solid #e5e5e5">';
					 text = text +'<p>No orders confirmed.</p>';
					 text = text +'</div>';
					 document.getElementById('display_id1').innerHTML = text;
					 $('#loadTry').popup("close");
			}
			else
			{
			var t=0;
			var s11=0;
            var p11=0;
			var notcomplete=0;
			for(var n=0;n<len;n++)
			{
			var result1 = results.rows.item(n);
				
				
				
				 tx.executeSql('SELECT customer_ordered_stores.*,customer_orders.*,customer_orders_items.*,GROUP_CONCAT(customer_orders_items.itemName) as itname,GROUP_CONCAT(customer_orders_items.price) as itprice,GROUP_CONCAT(customer_orders_items.quantity) as itqty,GROUP_CONCAT(customer_orders_items.taxRate) as ittax,GROUP_CONCAT(customer_orders_items.imageURL) as imgurl FROM customer_ordered_stores inner join customer_orders on customer_ordered_stores.storeid=customer_orders.mainstoreid inner join customer_orders_items on customer_orders_items.mainorderid=customer_orders.orderid where customer_orders.mainstoreid="'+result1.storeid+'" and customer_orders.status="COMPLETE" group by customer_orders.orderid', [], function (tx, results1) {
				 var len1 = results1.rows.length;
                               
                               
                    if(len1=='0')
                    {
                              
                               notcomplete++;
                               
                    }
                    else
                    {
				
				 var result = results1.rows.item(0);
					 
				text = text + '<div data-role="collapsible" id="test-collapsible1'+result.storeid+'" data-mini="true" data-theme="k" data-content-theme="i" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d" data-inline="true" style="position:relative;top:-10px;">';
			    text = text + '<h4 class="bluetext" style="background-color:#e5e5e5;" data-role="button"  onclick="del_orderhistory_div('+result.storeid+');" data-inline="true" >'+result.storename+'('+len1+')</h4>';
				
				
				 for(var x=0;x<len1;x++)
				 {
				 var result = results1.rows.item(x);
				  
				 
				 var splitdate=(result.created_date).split("T");
			
			    text = text + '<ul data-role="listview">';
			    
			        text = text + '<li  data-icon="arrow-r2" style="border:5px solid #e5e5e5;padding-left:0px;padding-top: 2px;">';

			        	text = text + '<div id="outdiv">';
			        		text = text + '<div  id="inn_div" style="padding-left:10px;float:left;padding-top:20px;">';
							
									text = text + '<label class="blacktext" style="font-weight:normal;font-size:14px;font-family:Roboto">';
								text = text + '<table style="position: relative;top: -8px;">';
									text = text + '<tr>';
										text = text + '<td >Order No:</td>';
										text = text + '<td class="orangetextnavbar">'+result.orderid+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Date:</td>';
										text = text + '<td  class="orangetextnavbar">'+splitdate[0]+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Tax:</td>';
										text = text + '<td class="orangetextnavbar">'+result.tax+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Total</td>';
										text = text + '<td class="orangetextnavbar">$ '+result.total+'</td>';
									text = text + '</tr>';
								text = text + '</table>';
							text = text + '</label>';
				    text = text + '</div>';
					
					
					text = text + '<div style="">';
					text = text + '<div id="inn_con'+x+'" style="float:right;position:relative;right:-6px;top:12px"><label style="position:relative;right:10px;top:-3px;font-size:14px;" class="lab">Confirmed?</label><img style=" top:6px; border:1px solid #ff9000;" width="15px" height="15px" src="images/tick_.png"/>';
					text = text + '</div>';
					
					
			        	
			        		
			        		text = text + '</div>';
					
					var splitnameinner=(result.itname).split(",");
				
				 var splitpriceinner=(result.itprice).split(",");
				  var splitquantityinner=(result.itqty).split(",");
				  var splittaxinner=(result.ittax).split(",");
             
					for(var k=0;k<splitnameinner.length;k++)
					{
				
							var total =(splitpriceinner[k] * splitquantityinner[k])*100/100;
					
							var itemtax=((((splittaxinner[k] * total)/100)*100)/100).toFixed(2);
							var itemtotal= (((parseFloat(total) + parseFloat(itemtax))*100)/100).toFixed(2);
							
							
			        		text = text + '<div class="clr"></div>';
			        		text = text + '<div style="left:10px;float:left;width:80px;" >';
			        	
                            
                               text = text + '<img style="width:80px; height:80px;" id="in1'+p11+'" src="images/no_image.png" />';
                               
                               
			        		text = text + '</div>';
			        		text = text + '<div  id="storeAddress" style="position:relative;float:left;width:60%;padding-left:15px;">';
									text = text + '<div  style="float:left;padding-top:1px;width:150px;line-height:25px;white-space:nowrap;margin-top:-5px;">';
											text = text + '<span id="storeRestaurant'+p11+'" class="storeAddPopUpList" onclick="StoreAddressPopUp(this.id);" style="white-space:nowrap;">';
										
										text = text + '<span class="lab" style="position:relative;left:-5px;top:-2px;">'+splitnameinner[k]+'</span>';
										text = text + '</span>';
										text = text + '</div>';
										text = text + '<div class="clr"></div>';
									text = text + '<label class="blacktext" style="font-weight:normal;font-size:14px;font-family:Roboto;">';
										text = text + '<div style="position: relative;top: -8px;">';
										
											text = text + '<div class="divheight">';
												text = text + '<div class="spanheight" style="width:65px;">Unit Price:</div>';
												text = text + '<div class="orangetextnavbar spanheight" style="">$ '+splitpriceinner[k]+'</div>';
											text = text + '</div>';
											text = text + '<div class="clr"></div>';
											text = text + '<div class="divheight">';
												text = text + '<div class="spanheight" style="width:65px;">Qty:</div>';
												text = text + '<div class="orangetextnavbar spanheight" style="">'+splitquantityinner[k]+'</div>';
											text = text + '</div>';
											text = text + '<div class="clr"></div>';
											text = text + '<div class="divheight">';
												text = text + '<div class="spanheight" style="width:65px;">Tax:</div>';
												text = text + '<div class="orangetextnavbar spanheight" style="">'+itemtax+'</div>';
											text = text + '</div>';
											text = text + '<div class="clr"></div>';
											text = text + '<div class="divheight">';
												text = text + '<div class="spanheight" style="width:65px;">Total:</div>';
												text = text + '<div class="orangetextnavbar spanheight" style="">$ '+itemtotal+'</div>';
											text = text + '</div>';
											text = text + '<div class="clr"></div>';
										text = text + '</div>';
									text = text + '</label>';
						   		text = text + '</div>';
							text = text + '</div>';
			        	 text = text + '<div class="clr">';
                            p11++;
						
						$('#loadTry').popup("close");
			        }
					//t++;
			      text = text + '</div>';  
				 text = text + '</li>';
			    text = text + '</ul>';
				}
			text = text + '</div>';

			
			
			text = text + '<div id="divhistory'+result.storeid+'" class="divcolor" style="padding:20px 10px;display:block;position: relative;top: -18px;border-top: 6px solid #e5e5e5">';
			text = text + '<div id="outdiv">';
			
			
			
			        		text = text + '<div  id="inn_div" style="padding-left:0px;float:left;padding-top:4px">';
							var splitdate=(result.created_date).split("T");
								text = text + '<label class="blacktext" style="font-weight:normal;font-size:14px;font-family:Roboto">';
								text = text + '<table style="position: relative;top: -8px;">';
									text = text + '<tr>';
										text = text + '<td >Order No:</td>';
										text = text + '<td class="orangetextnavbar">'+result.orderid+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Date:</td>';
										text = text + '<td class="orangetextnavbar">'+splitdate[0]+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Tax:</td>';
										text = text + '<td class="orangetextnavbar">'+result.tax+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Total</td>';
										text = text + '<td class="orangetextnavbar">$ '+result.total+'</td>';
									text = text + '</tr>';
								text = text + '</table>';
							text = text + '</label>';
				   text = text + '</div>';
				   
				
					text = text + '<div id="inn_con" class="divcolor" style="float:right;position:relative;right:-8px;top:-9px;width:80px;"><label style="position:relative;right:8px;font-size:14px;float:left;margin-left:-15px;margin-top:-15px;width:75px;height:20px;" class="lab">Confirmed?</label><img style="float:left;margin-top:-14px;border:1px solid #ff9000;vertical-align: middle;" width="15px" height="15px" src="images/tick_.png"/>';
					text = text + '</div>';
			        text = text + '<div class="clr"></div>';	
			       	text = text + '<div id="div_items'+result.storeid+'"></div>';	
			       
				 
				 var splitname=(result.itname).split(",");
				 
				 var splitprice=(result.itprice).split(",");
				  var splitquantity=(result.itqty).split(",");
				  var splittax=(result.ittax).split(",");
				 
				   for(var j=0;j<splitname.length;j++)
					{
					 
					var total =(splitprice[j] * splitquantity[j])*100/100;
					 var itemtax=((((splittax[j] * total)/100)*100)/100).toFixed(2);
					 var itemtotal= (((parseFloat(total) + parseFloat(itemtax))*100)/100).toFixed(2);
					 
					
			        		 text = text + '<div class="clr"></div>';
			        		text = text + '<div style="float:left;" >';
							
			        		
                               text = text + '<img style="width:80px; height:80px;" id="out1'+s11+'" src="images/no_image.png" />';
                               
                               
			        		text = text + '</div>';
			        		text = text + '<div  id="storeAddress" style="float:left;width:60%;padding-left:15px;white-space:nowrap;position:relative;">';
								text = text + '<div  style="float:left;padding-top:1px;width:150px;line-height:35px;margin-top:-15px;">';
											text = text + '<span id="storeRestaurant1'+s11+'" class="storeAddPopUpList" onclick="StoreAddressPopUp(this.id);">';
										
										text = text + '<span class="lab" style="position:relative;left:-5px;top:-2px;">'+splitname[j]+'</span>';
										text = text + '</span>';
										text = text + '</div>';
										text = text +'<div class="clr"></div>';	
									text = text + '<label class="blacktext" style="font-weight:normal;font-size:14px;font-family:Roboto;">';
										text = text + '<table style="position: relative;top: -10px;">';
										
											text = text + '<tr>';
												text = text + '<td >Unit Price:</td>';
												text = text + '<td class="orangetextnavbar">$ '+splitprice[j]+'</td>';
											text = text + '</tr>';
											text = text + '<tr>';
												text = text + '<td>Qty:</td>';
												text = text + '<td class="orangetextnavbar">'+splitquantity[j]+'</td>';
											text = text + '</tr>';
											text = text + '<tr>';
												text = text + '<td>Tax:</td>';
												text = text + '<td class="orangetextnavbar">'+itemtax+'</td>';
											text = text + '</tr>';
											text = text + '<tr>';
												text = text + '<td>Total:</td>';
												text = text + '<td class="orangetextnavbar">$ '+itemtotal+'</td>';
											text = text + '</tr>';
										text = text + '</table>';
									text = text + '</label>';
						   		text = text + '</div>';
			        	text = text + '<div class="clr"></div>';
                               
                               s11++;
						
					}
					
						
				text = text + '</div>';
				text = text + '</div>';
				text = text + '<hr/>';
                document.getElementById('display_id1').innerHTML = text;
                $("#display_id1").trigger("create");
                               
                }
                               
                              
                               if(notcomplete==len && len1=='0')
                               {
                              
                               document.getElementById('display_id').innerHTML = "";
                               document.getElementById('display_id1').innerHTML = "";
                               text = text +'<div id="" class="divcolor" style="padding: 20px 20px; display: block; position: relative; top: -5px; border: 6px solid #e5e5e5">';
                               text = text +'<p>No orders confirmed.</p>';
                               text = text +'</div>';
                               document.getElementById('display_id1').innerHTML = text;
                               $('#loadTry').popup("close");
                               
                               }
                              
				
				});
                           
                
				}
				
                 setTimeout(function(){get_cust_orderhistory1()},1000);
				}
                
				});
				
				});
		
		}
    var refreshcount1=0;
    function get_cust_orderhistory1()
    {
       
        
        var userID = localStorage.getItem('userid');
                BUYDEMO.transaction(function(tx) {
            tx.executeSql("SELECT * FROM customer_ordered_stores where customer_ordered_stores.customerid='"+userID+"'", [], function (tx, resultss) {
                                          var lencomplete = resultss.rows.length;
                                          
                          
                                          var t=0;
                                          var s2=0;
                                          var p2=0;
                                          for(var n1=0;n1<lencomplete;n1++)
                                          {
                                          
                                          var result2 = resultss.rows.item(n1);
                                          
                                         
                                          
                                          tx.executeSql('SELECT customer_ordered_stores.*,customer_orders.*,customer_orders_items.*,GROUP_CONCAT(customer_orders_items.itemName) as itname,GROUP_CONCAT(customer_orders_items.price) as itprice,GROUP_CONCAT(customer_orders_items.quantity) as itqty,GROUP_CONCAT(customer_orders_items.taxRate) as ittax,GROUP_CONCAT(customer_orders_items.imageURL) as imgurl FROM customer_ordered_stores inner join customer_orders on customer_ordered_stores.storeid=customer_orders.mainstoreid inner join customer_orders_items on customer_orders_items.mainorderid=customer_orders.orderid where customer_orders.mainstoreid="'+result2.storeid+'" and customer_orders.status="COMPLETE" group by customer_orders.orderid', [], function (tx, results2) {
                                                        var len1complete = results2.rows.length;
                                                        
                                                        if(len1complete == '0')
                                                        {
                                                        
                                                        }
                                                        else
                                                        {
                                                       
                                                        var result = results2.rows.item(0);
                                                        
                                                        
                                                        for(var x=0;x<len1complete;x++)
                                                        {
                                                        
                                                        var result = results2.rows.item(x);
                                                        
                                                        
                                                        var splitdate=(result.created_date).split("T");
                                                        
                                                        var splitnameinner=(result.itname).split(",");
                                                       
                                                        var splitpriceinner=(result.itprice).split(",");
                                                        var splitquantityinner=(result.itqty).split(",");
                                                        var splittaxinner=(result.ittax).split(",");
                                                        var splitimagein1;
                                                        if(!result.imgurl)
                                                        {
                                                        splitimagein1='images/no_image.png,'.split(",");
                                                        }
                                                        else
                                                        {
                                                        splitimagein1=(result.imgurl).split(",");
                                                        }
                                                       
                                                        
                                                        for(var k=0;k<splitnameinner.length;k++)
                                                        {
                                                        
                                                      
                                                        
                                                        var store_url = splitimagein1[k].split('/');
                                                        var store_len = store_url.length;
                                                        var store_imgin1 = store_url[store_len - 1];
                                                        
                                                       
                                                       
                                                        
                                                        if(store_imgin1=='' || store_imgin1=='no_image.png')
                                                        {
                                                        
                                                        }
                                                        else
                                                        {
                                                        var imgin1 = new Image();
                                                        var dsin1 = new Date();
                                                        var secin1 = dsin1.getSeconds();
                                                        //document.getElementById("smallImage").src=path_arr+"/"+returnSuccess[1]+"?"+sec;
                                                        imgin1.src = path_arr+'/'+store_imgin1;
                                                       
                                                        if(!imgin1.complete)
                                                        {
                                                        
                                                        }
                                                        else
                                                        {
                                                       
                                                        
                                                        document.getElementById("in1"+p2).src = path_arr+'/'+store_imgin1;
                                                       
                                                        }
                                                        
                                                      
                                                        
                                                        }
                                                       
                                                        p2++;
                                                       
                                                        
                                                        
                                                        }
                                                        
                                                     
                                                        }
                                                      
                                                        
                                                        
                                                        
                                 
                                                        
                                                        
                                                        var splitname=(result.itname).split(",");
                                                     
                                                        var splitimageout1;
                                                        
                                                        if(!result.imgurl)
                                                        {
                                                        splitimageout1='images/no_image.png,'.split(",");
                                                        }
                                                        else
                                                        {
                                                        splitimageout1=(result.imgurl).split(",");
                                                        }
                                                        for(var j=0;j<splitname.length;j++)
                                                        {
                                                      
                                                        
                                                        var store_url = splitimageout1[j].split('/');
                                                        var store_len = store_url.length;
                                                        var store_imgout1 = store_url[store_len - 1];
                                                        
                                                        
                                                        if(store_imgout1=='no_image.png')
                                                        {
                                                       
                                                        }
                                                        else
                                                        {
                                                        
                                                        var imgout1 = new Image();
                                                        var dsout1 = new Date();
                                                        var secout1 = dsout1.getSeconds();
                                                        //document.getElementById("smallImage").src=path_arr+"/"+returnSuccess[1]+"?"+sec;
                                                        imgout1.src = path_arr+'/'+store_imgout1;
                                                    
                                                        if(!imgout1.complete)
                                                        {
                                                      
                                                       
                                                        }
                                                        else
                                                        {
                                                       
                                                       
                                                        document.getElementById("out1"+s2).src = path_arr+'/'+store_imgout1;
                                                        
                                                        }
                                                        
                                                        
                                                        
                                                        
                                                        }

                                                        
                                                        s2++;
                                                        
                                                        }
                                                        
                                                        
                                                        }

                                                        
                                                        });
                                          
                                          
                                            if(refreshcount1 == '1')
                                            {
                          
                                              setTimeout(function(){get_cust_orderhistory1()},3000);
                                          
                                            }
                                             refreshcount1++;
                                          }
                                          
                                          
                                          
                                          });
                            
                            });
                            
    }

		
		function get_recent_orderhistory()
		{
            text='';
            document.getElementById('display_id').innerHTML = "";
            document.getElementById('display_id1').innerHTML = "";
			var userID = localStorage.getItem('userid');
			
			
			var today = new Date();
			var todaydate = today.getFullYear() + "-" +("0" + ( today.getMonth() + 1)).slice(-2) + "-" +("0" +  today.getDate()).slice(-2);
			todaydate = new Date(todaydate);
			
			var monthback = new Date(today.getTime() - 30*24*60*60*1000);
			var lastback = monthback.getFullYear() + "-" +("0" + ( monthback.getMonth() + 1)).slice(-2) + "-" +("0" +  monthback.getDate()).slice(-2);
			lastback = new Date(lastback);
			
			
			
			 BUYDEMO.transaction(function(tx) {
			 tx.executeSql("SELECT * FROM customer_ordered_stores where customer_ordered_stores.customerid='"+userID+"'", [], function (tx, results) {
			var len = results.rows.length;
			
			if(len=='0')
			{
					 document.getElementById('display_id').innerHTML = "";
                     document.getElementById('display_id1').innerHTML = "";
					 text = text +'<div id="" class="divcolor" style="padding: 20px 20px; display: block; position: relative; top: -5px; border: 6px solid #e5e5e5">';
					 text = text +'<p>No Recent Orders Available</p>';
					 text = text +'</div>';
					 document.getElementById('display_id').innerHTML = text;
					 $('#loadTry').popup("close");
			}
			else
			{
				 
			
			
			var t=0;
			var s=0;
			var p=0;
			var count_nonapplicable_date=1;
			for(var n=0;n<len;n++)
			{ 
			
			var result1 = results.rows.item(n);
				
				
				
				 tx.executeSql('SELECT customer_ordered_stores.*,customer_orders.*,customer_orders_items.*,GROUP_CONCAT(customer_orders_items.itemName) as itname,GROUP_CONCAT(customer_orders_items.price) as itprice,GROUP_CONCAT(customer_orders_items.quantity) as itqty,GROUP_CONCAT(customer_orders_items.taxRate) as ittax,GROUP_CONCAT(customer_orders_items.imageURL) as imgurl FROM customer_ordered_stores inner join customer_orders on customer_ordered_stores.storeid=customer_orders.mainstoreid inner join customer_orders_items on customer_orders_items.mainorderid=customer_orders.orderid where customer_orders.mainstoreid="'+result1.storeid+'" group by customer_orders.orderid', [], function (tx, results1) {
				 var len1 = results1.rows.length;
				 
				 var result = results1.rows.item(0);
				  
				 
				 var split_date=result.created_date.split("T"); 
				 var createdate=new Date(split_date[0]);
				 
				if((createdate >= lastback) && (createdate <= todaydate))
				{
				
				text = text + '<div data-role="collapsible" id="test-collapsible1'+result.storeid+'" data-mini="true" data-theme="k" data-content-theme="i" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d" data-inline="true" style="position:relative;top:-10px;">';
			    text = text + '<h4 class="bluetext" style="background-color:#e5e5e5;" data-role="button"  onclick="del_orderhistory_div('+result.storeid+');" data-inline="true" >'+result.storename+'('+len1+')</h4>';
				
				
				 for(var x=0;x<len1;x++)
				 {
				 var result = results1.rows.item(x);
				 
				 var splitdate=(result.created_date).split("T");
				
			    text = text + '<ul data-role="listview">';
			    
			        text = text + '<li  data-icon="arrow-r2" style="border:5px solid #e5e5e5;padding-left:0px;padding-top: 2px;">';

			        	text = text + '<div id="outdiv" style="">';
			        		text = text + '<div  id="inn_div" style="padding-left:0px;float:left;padding-top:20px">';
							
									text = text + '<label class="blacktext" style="font-weight:normal;font-size:14px;font-family:Roboto">';
								text = text + '<table style="position: relative;top: -8px;">';
									text = text + '<tr>';
										text = text + '<td>Order No:</td>';
										text = text + '<td class="orangetextnavbar">'+result.orderid+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Date:</td>';
										text = text + '<td  class="orangetextnavbar">'+splitdate[0]+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Tax:</td>';
										text = text + '<td class="orangetextnavbar">'+result.tax+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Total</td>';
										text = text + '<td class="orangetextnavbar">$ '+result.total+'</td>';
									text = text + '</tr>';
								text = text + '</table>';
							text = text + '</label>';
				    text = text + '</div>';
					
					//text = text + '<div class="clr"></div>';
					text = text + '<div>';
					if(result.status=='COMPLETE')
					{
						text = text + '<div id="inn_con'+x+'" style="float:right;position:relative;right:-6px;top:12px"><label style="position:relative;right:10px;top:-3px;font-size:14px;" class="lab">Confirmed?</label><img style=" top:6px; border:1px solid #ff9000;" width="15px" height="15px" src="images/tick_.png"/>';
						text = text + '</div>';
					}
					
			       
			        		
			        		text = text + '</div>';
				
					var splitnameinner=(result.itname).split(",");
				
				 var splitpriceinner=(result.itprice).split(",");
				  var splitquantityinner=(result.itqty).split(",");
				  var splittaxinner=(result.ittax).split(",");
				  var splitimageinner=(result.imgurl).split(",");
				
					for(var k=0;k<splitnameinner.length;k++)
					{
					
							
							var total =(splitpriceinner[k] * splitquantityinner[k])*100/100;
					
							var itemtax=((((splittaxinner[k] * total)/100)*100)/100).toFixed(2);
							var itemtotal= (((parseFloat(total) + parseFloat(itemtax))*100)/100).toFixed(2);
							
						
                            
                               var returnSuccessorder = new Array();
                               returnSuccessorder[0] = splitimageinner[k];
                               
                               
                               
                               var store_urlin = splitimageinner[k].split('/');
                               var store_lenin = store_urlin.length;
                               var store_imgin = store_urlin[store_lenin - 1];
                               returnSuccessorder[1] = store_imgin;
                               returnSuccessorder[2] = p;
                               
			        		text = text + '<div class="clr"></div>';
			        		text = text + '<div style="left:10px;float:left;width:80px;">';
							
                              var imgin = new Image();
                               var dsin= new Date();
                               var secin = dsin.getSeconds();
                               //document.getElementById("smallImage").src=path_arr+"/"+returnSuccess[1]+"?"+sec;
                               imgin.src = path_arr+'/'+store_imgin;
                               
                             if(!imgin.complete)
                               {
			        		text = text + '<img style="width:80px; height:80px;" id="in'+p+'" src="images/no_image.png" />';
                               }
                               else
                               {
                               text = text + '<img id="in'+p+'" src="'+path_arr+'/'+store_imgin+'" style="width:80px;height:80px;" />';
                              }
							
							
							
			        		text = text + '</div>';
			        	
							text = text + '<div id="storeAddress" style="position: relative;left:5px;float:left;padding-left:15px;width:60%;white-space:nowrap;">';
									text = text + '<div  style="float:left;padding-top:1px;width:150px;line-height:25px;white-space:nowrap;margin-top:-5px;">';
											text = text + '<span id="storeRestaurant'+p+'" class="storeAddPopUpList" onclick="StoreAddressPopUp(this.id);" style="white-space:nowrap;">';
										
										text = text + '<span class="lab" style="position:relative;left:-5px;top:-2px;">'+splitnameinner[k]+'</span>';
										text = text + '</span>';
										text = text + '</div>';
									
									text = text + '<div class="clr"></div>';
									
										text = text + '<div class="blacktext" style="position: relative;top: -8px;font-weight:normal;font-size:14px;font-family:Roboto;">';
										
											text = text + '<div class="divheight">';
												text = text + '<div class="spanheight" style="width:65px;">Unit Price:</div>';
												text = text + '<div class="orangetextnavbar spanheight" style="">$ '+splitpriceinner[k]+'</div>';
											text = text + '</div>';
											text = text + '<div class="clr"></div>';
											text = text + '<div class="divheight">';
												text = text + '<div class="spanheight" style="width:65px;">Qty:</div>';
												text = text + '<div class="orangetextnavbar spanheight" style="">'+splitquantityinner[k]+'</div>';
											text = text + '</div>';
											text = text + '<div class="clr"></div>';
											text = text + '<div class="divheight">';
												text = text + '<div class="spanheight" style="width:65px;">Tax:</div>';
												text = text + '<div class="orangetextnavbar spanheight" style="">'+itemtax+'</div>';
											text = text + '</div>';
											text = text + '<div class="clr"></div>';
											text = text + '<div class="divheight">';
												text = text + '<div class="spanheight" style="width:65px;">Total:</div>';
												text = text + '<div class="orangetextnavbar spanheight" style="">$ '+itemtotal+'</div>';
											text = text + '</div>';
											text = text + '<div class="clr"></div>';
										text = text + '</div>';
									
						   		text = text + '</div>';
							text = text + '</div>';
			        	 text = text + '<div class="clr">';
                               p++;
						
							$('#loadTry').popup("close");
			        }
					//t++;
			      text = text + '</div>';  
				 text = text + '</li>';
			    text = text + '</ul>';
				}
			text = text + '</div>';

			
			
			text = text + '<div id="divhistory'+result.storeid+'" class="divcolor" style="padding:20px 10px; display:block;position: relative;top: -18px;border-top: 6px solid #e5e5e5">';
			text = text + '<div id="outdiv">';
			
			
			
			        		text = text + '<div  id="inn_div" style="padding-left:0px;float:left;padding-top:4px">';
							var splitdate=(result.created_date).split("T");
								text = text + '<label class="blacktext" style="font-weight:normal;font-size:14px;font-family:Roboto">';
								text = text + '<table style="position: relative;top: -8px;">';
									text = text + '<tr>';
										text = text + '<td >Order No:</td>';
										text = text + '<td class="orangetextnavbar">'+result.orderid+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Date:</td>';
										text = text + '<td class="orangetextnavbar">'+splitdate[0]+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Tax:</td>';
										text = text + '<td class="orangetextnavbar">'+result.tax+'</td>';
									text = text + '</tr>';
									text = text + '<tr>';
										text = text + '<td>Total</td>';
										text = text + '<td class="orangetextnavbar">$ '+result.total+'</td>';
									text = text + '</tr>';
								text = text + '</table>';
							text = text + '</label>';
				   text = text + '</div>';
				   
				  
					if(result.status=='COMPLETE')
					{
					text = text + '<div id="inn_con" class="divcolor" style="float:right;position:relative;right:-8px;top:-9px;width:80px;"><label style="position:relative;right:8px;font-size:14px;float:left;margin-left:-15px;margin-top:-15px;width:75px;height:20px;" class="lab">Confirmed?</label><img style="float:left;margin-top:-14px;border:1px solid #ff9000;vertical-align: middle;" width="15px" height="15px" src="images/tick_.png"/>';
					text = text + '</div>';
					}
			        text = text + '<div class="clr"></div>';	
			       	text = text + '<div id="div_items'+result.storeid+'"></div>';	
			       
				   
				 var splitname=(result.itname).split(",");
				
				 var splitprice=(result.itprice).split(",");
				  var splitquantity=(result.itqty).split(",");
				  var splittax=(result.ittax).split(",");
				  var splitimage=(result.imgurl).split(",");
				
				   for(var j=0;j<splitname.length;j++)
					{
					
					 var total =(splitprice[j] * splitquantity[j])*100/100;
					 var itemtax=((((splittax[j] * total)/100)*100)/100).toFixed(2);
					 var itemtotal= (((parseFloat(total) + parseFloat(itemtax))*100)/100).toFixed(2);
					 
					var store_url = splitimage[j].split('/');
							var store_len = store_url.length;
							var store_img = store_url[store_len - 1];
                               
                               var returnSuccess1 = new Array();
                               returnSuccess1[0] = splitimage[j];
                               
                               
                               
                            
                               returnSuccess1[1] = store_img;
                               returnSuccess1[2] = s;
                               
                             
			        		 text = text + '<div class="clr"></div>';
			        		text = text + '<div style="float:left;" >';
							
						
                            var img = new Image();
							var ds = new Date();
							var sec = ds.getSeconds();
		
							img.src = path_arr+'/'+store_img;
				  
							if(!img.complete)
							{
								text = text + '<img style="width:80px; height:80px;" id="out'+s+'" src="images/no_image.png" />';
							}
							else
							{
								 text = text + '<img id="out'+s+'" src="'+path_arr+'/'+store_img+'" style="width:80px;height:80px;" />';
								
								
							}
							
			        		text = text + '</div>';
			        		text = text + '<div  id="storeAddress" style="float:left;width:60%;padding-left:15px;white-space:nowrap;position:relative;">';
								text = text + '<div  style="float:left;width:150px;line-height:35px;white-space:nowrap;margin-top:-12px;">';
											text = text + '<span id="storeRestaurant1'+s+'" class="storeAddPopUpList" onclick="StoreAddressPopUp(this.id);" style="white-space:nowrap;">';
										
										text = text + '<span class="lab" style="position:relative;left:-5px;top:-2px;">'+splitname[j]+'</span>';
										text = text + '</span>';
										text = text + '</div>';
										text = text +'<div class="clr"></div>';	
									text = text + '<label class="blacktext" style="font-weight:normal;font-size:14px;font-family:Roboto;">';
										text = text + '<table style="position: relative;top: -10px;">';
										
											text = text + '<tr>';
												text = text + '<td>Unit Price:</td>';
												text = text + '<td class="orangetextnavbar">$ '+splitprice[j]+'</td>';
											text = text + '</tr>';
											text = text + '<tr>';
												text = text + '<td>Qty:</td>';
												text = text + '<td class="orangetextnavbar">'+splitquantity[j]+'</td>';
											text = text + '</tr>';
											text = text + '<tr>';
												text = text + '<td>Tax:</td>';
												text = text + '<td class="orangetextnavbar">'+itemtax+'</td>';
											text = text + '</tr>';
											text = text + '<tr>';
												text = text + '<td>Total:</td>';
												text = text + '<td class="orangetextnavbar">$ '+itemtotal+'</td>';
											text = text + '</tr>';
										text = text + '</table>';
									text = text + '</label>';
						   		text = text + '</div>';
			        	text = text + '<div class="clr"></div>';
                               s++;
						
					}
					
					
				text = text + '</div>';
				text = text + '</div>';
				text = text + '<hr/>';
				
				document.getElementById('display_id').innerHTML = text;
				$("#display_id").trigger("create");
				
				}
				else{
				
				count_nonapplicable_date++;
				
				if(count_nonapplicable_date==len)
				{
				 document.getElementById('display_id').innerHTML = "";
                 document.getElementById('display_id1').innerHTML = "";
					 text = text +'<div id="" class="divcolor" style="padding: 20px 20px; display: block; position: relative; top: -3px; border: 6px solid #e5e5e5">';
					 text = text +'<p>No Recent Orders Available</p>';
					 text = text +'</div>';
					 document.getElementById('display_id').innerHTML = text;
				}
					 $('#loadTry').popup("close");
				}
				});
				
				}
				
                       setTimeout(function(){get_recent_orderhistoryold()},3000);
				}
				
				
				});
				
				});
		}
		
        
        function get_recent_orderhistory1()
		{
            text='';
            document.getElementById('display_id').innerHTML = "";
            document.getElementById('display_id1').innerHTML = "";
			var userID = localStorage.getItem('userid');
			
			
			var today = new Date();
			var todaydate = today.getFullYear() + "-" +("0" + ( today.getMonth() + 1)).slice(-2) + "-" +("0" +  today.getDate()).slice(-2);
			todaydate = new Date(todaydate);
			
			var monthback = new Date(today.getTime() - 30*24*60*60*1000);
			var lastback = monthback.getFullYear() + "-" +("0" + ( monthback.getMonth() + 1)).slice(-2) + "-" +("0" +  monthback.getDate()).slice(-2);
			lastback = new Date(lastback);
			
			
			
            BUYDEMO.transaction(function(tx) {
                                tx.executeSql("SELECT * FROM customer_ordered_stores where customer_ordered_stores.customerid='"+userID+"'", [], function (tx, results) {
                                              var len = results.rows.length;
                                              
                                              if(len=='0')
                                              {
                                              document.getElementById('display_id').innerHTML = "";
                                              document.getElementById('display_id1').innerHTML = "";
                                              text = text +'<div id="" class="divcolor" style="padding: 20px 20px; display: block; position: relative; top: -5px; border: 6px solid #e5e5e5">';
                                              text = text +'<p>No Recent Orders Available</p>';
                                              text = text +'</div>';
                                              document.getElementById('display_id').innerHTML = text;
                                              $('#loadTry').popup("close");
                                              }
                                              else
                                              {
                                              
                                              
                                              
                                              var t=0;
                                              var s=0;
                                              var p=0;
                                              var count_nonapplicable_date=1;
                                              for(var n=0;n<len;n++)
                                              {
                                              
                                              var result1 = results.rows.item(n);
                                              
                                              
                                              
                                              tx.executeSql('SELECT customer_ordered_stores.*,customer_orders.*,customer_orders_items.*,GROUP_CONCAT(customer_orders_items.itemName) as itname,GROUP_CONCAT(customer_orders_items.price) as itprice,GROUP_CONCAT(customer_orders_items.quantity) as itqty,GROUP_CONCAT(customer_orders_items.taxRate) as ittax,GROUP_CONCAT(customer_orders_items.imageURL) as imgurl FROM customer_ordered_stores inner join customer_orders on customer_ordered_stores.storeid=customer_orders.mainstoreid inner join customer_orders_items on customer_orders_items.mainorderid=customer_orders.orderid where customer_orders.mainstoreid="'+result1.storeid+'" group by customer_orders.orderid', [], function (tx, results1) {
                                                            var len1 = results1.rows.length;
                                                            
                                                            var result = results1.rows.item(0);
                                                            
                                                            
                                                            var split_date=result.created_date.split("T");
                                                            var createdate=new Date(split_date[0]);
                                                            
                                                            if((createdate >= lastback) && (createdate <= todaydate))
                                                            {
                                                            
                                                            text = text + '<div data-role="collapsible" id="test-collapsible1'+result.storeid+'" data-mini="true" data-theme="k" data-content-theme="i" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d" data-inline="true" style="position:relative;top:-10px;">';
                                                            text = text + '<h4 class="bluetext" style="background-color:#e5e5e5;" data-role="button"  onclick="del_orderhistory_div('+result.storeid+');" data-inline="true" >'+result.storename+'('+len1+')</h4>';
                                                            
                                                            
                                                            for(var x=0;x<len1;x++)
                                                            {
                                                            var result = results1.rows.item(x);
                                                            
                                                            var splitdate=(result.created_date).split("T");
                                                            
                                                            text = text + '<ul data-role="listview">';
                                                            
                                                            text = text + '<li  data-icon="arrow-r2" style="border:5px solid #e5e5e5;padding-left:0px;padding-top: 2px;">';
                                                            
                                                            text = text + '<div id="outdiv" style="">';
                                                            text = text + '<div  id="inn_div" style="padding-left:0px;float:left;padding-top:20px">';
                                                            
                                                            text = text + '<label class="blacktext" style="font-weight:normal;font-size:14px;font-family:Roboto">';
                                                            text = text + '<table style="position: relative;top: -8px;">';
                                                            text = text + '<tr>';
                                                            text = text + '<td>Order No:</td>';
                                                            text = text + '<td class="orangetextnavbar">'+result.orderid+'</td>';
                                                            text = text + '</tr>';
                                                            text = text + '<tr>';
                                                            text = text + '<td>Date:</td>';
                                                            text = text + '<td  class="orangetextnavbar">'+splitdate[0]+'</td>';
                                                            text = text + '</tr>';
                                                            text = text + '<tr>';
                                                            text = text + '<td>Tax:</td>';
                                                            text = text + '<td class="orangetextnavbar">'+result.tax+'</td>';
                                                            text = text + '</tr>';
                                                            text = text + '<tr>';
                                                            text = text + '<td>Total</td>';
                                                            text = text + '<td class="orangetextnavbar">$ '+result.total+'</td>';
                                                            text = text + '</tr>';
                                                            text = text + '</table>';
                                                            text = text + '</label>';
                                                            text = text + '</div>';
                                                            
                                                            
                                                            text = text + '<div>';
                                                            if(result.status=='COMPLETE')
                                                            {
                                                            text = text + '<div id="inn_con'+x+'" style="float:right;position:relative;right:-6px;top:12px"><label style="position:relative;right:10px;top:-3px;font-size:14px;" class="lab">Confirmed?</label><img style=" top:6px; border:1px solid #ff9000;" width="15px" height="15px" src="images/tick_.png"/>';
                                                            text = text + '</div>';
                                                            }
                                                            
                                                            
                                                            
                                                            text = text + '</div>';
                                                            
                                                            var splitnameinner=(result.itname).split(",");
                                                            
                                                            var splitpriceinner=(result.itprice).split(",");
                                                            var splitquantityinner=(result.itqty).split(",");
                                                            var splittaxinner=(result.ittax).split(",");
                                                            var splitimageinner=(result.imgurl).split(",");
                                                           
                                                            for(var k=0;k<splitnameinner.length;k++)
                                                            {
                                                          
                                                            
                                                            var total =(splitpriceinner[k] * splitquantityinner[k])*100/100;
                                                            
                                                            var itemtax=((((splittaxinner[k] * total)/100)*100)/100).toFixed(2);
                                                            var itemtotal= (((parseFloat(total) + parseFloat(itemtax))*100)/100).toFixed(2);
                                                            
                                                            
                                                            
                                                            var returnSuccessorder = new Array();
                                                            returnSuccessorder[0] = splitimageinner[k];
                                                            
                                                            
                                                            
                                                            var store_urlin = splitimageinner[k].split('/');
                                                            var store_lenin = store_urlin.length;
                                                            var store_imgin = store_urlin[store_lenin - 1];
                                                            returnSuccessorder[1] = store_imgin;
                                                            returnSuccessorder[2] = p;
                                                         
                                                            text = text + '<div class="clr"></div>';
                                                            text = text + '<div style="left:10px;float:left;width:80px;">';
                                                            
                                                            
                                                            text = text + '<img style="width:80px; height:80px;" id="in'+p+'" src="'+path_arr+'/'+store_imgin+'"  />';
                                                            
                                                            
                                                            
                                                            text = text + '</div>';
                                                            
                                                            text = text + '<div id="storeAddress" style="position: relative;left:5px;float:left;padding-left:15px;width:60%;white-space:nowrap;">';
                                                            text = text + '<div  style="float:left;padding-top:1px;width:150px;line-height:25px;white-space:nowrap;margin-top:-5px;">';
                                                            text = text + '<span id="storeRestaurant'+p+'" class="storeAddPopUpList" onclick="StoreAddressPopUp(this.id);" style="white-space:nowrap;">';
                                                            
                                                            text = text + '<span class="lab" style="position:relative;left:-5px;top:-2px;">'+splitnameinner[k]+'</span>';
                                                            text = text + '</span>';
                                                            text = text + '</div>';
                                                            
                                                            text = text + '<div class="clr"></div>';
                                                            
                                                            text = text + '<div class="blacktext" style="position: relative;top: -8px;font-weight:normal;font-size:14px;font-family:Roboto;">';
                                                            
                                                            text = text + '<div class="divheight">';
                                                            text = text + '<div class="spanheight" style="width:65px;">Unit Price:</div>';
                                                            text = text + '<div class="orangetextnavbar spanheight" style="">$ '+splitpriceinner[k]+'</div>';
                                                            text = text + '</div>';
                                                            text = text + '<div class="clr"></div>';
                                                            text = text + '<div class="divheight">';
                                                            text = text + '<div class="spanheight" style="width:65px;">Qty:</div>';
                                                            text = text + '<div class="orangetextnavbar spanheight" style="">'+splitquantityinner[k]+'</div>';
                                                            text = text + '</div>';
                                                            text = text + '<div class="clr"></div>';
                                                            text = text + '<div class="divheight">';
                                                            text = text + '<div class="spanheight" style="width:65px;">Tax:</div>';
                                                            text = text + '<div class="orangetextnavbar spanheight" style="">'+itemtax+'</div>';
                                                            text = text + '</div>';
                                                            text = text + '<div class="clr"></div>';
                                                            text = text + '<div class="divheight">';
                                                            text = text + '<div class="spanheight" style="width:65px;">Total:</div>';
                                                            text = text + '<div class="orangetextnavbar spanheight" style="">$ '+itemtotal+'</div>';
                                                            text = text + '</div>';
                                                            text = text + '<div class="clr"></div>';
                                                            text = text + '</div>';
                                                            
                                                            text = text + '</div>';
                                                            text = text + '</div>';
                                                            text = text + '<div class="clr">';
                                                            p++;
                                                            
                                                            $('#loadTry').popup("close");
                                                            }
                                                            
                                                            text = text + '</div>';  
                                                            text = text + '</li>';
                                                            text = text + '</ul>';
                                                            }
                                                            text = text + '</div>';
                                                            
                                                            
                                                            
                                                            text = text + '<div id="divhistory'+result.storeid+'" class="divcolor" style="padding:20px 10px; display:block;position: relative;top: -18px;border-top: 6px solid #e5e5e5">';
                                                            text = text + '<div id="outdiv">';
                                                            
                                                            
                                                            
                                                            text = text + '<div  id="inn_div" style="padding-left:0px;float:left;padding-top:4px">';
                                                            var splitdate=(result.created_date).split("T");
                                                            text = text + '<label class="blacktext" style="font-weight:normal;font-size:14px;font-family:Roboto">';
                                                            text = text + '<table style="position: relative;top: -8px;">';
                                                            text = text + '<tr>';
                                                            text = text + '<td >Order No:</td>';
                                                            text = text + '<td class="orangetextnavbar">'+result.orderid+'</td>';
                                                            text = text + '</tr>';
                                                            text = text + '<tr>';
                                                            text = text + '<td>Date:</td>';
                                                            text = text + '<td class="orangetextnavbar">'+splitdate[0]+'</td>';
                                                            text = text + '</tr>';
                                                            text = text + '<tr>';
                                                            text = text + '<td>Tax:</td>';
                                                            text = text + '<td class="orangetextnavbar">'+result.tax+'</td>';
                                                            text = text + '</tr>';
                                                            text = text + '<tr>';
                                                            text = text + '<td>Total</td>';
                                                            text = text + '<td class="orangetextnavbar">$ '+result.total+'</td>';
                                                            text = text + '</tr>';
                                                            text = text + '</table>';
                                                            text = text + '</label>';
                                                            text = text + '</div>';
                                                            
                                                           
                                                            if(result.status=='COMPLETE')
                                                            {
                                                            text = text + '<div id="inn_con" class="divcolor" style="float:right;position:relative;right:-8px;top:-9px;width:80px;"><label style="position:relative;right:8px;font-size:14px;float:left;margin-left:-15px;margin-top:-15px;width:75px;height:20px;" class="lab">Confirmed?</label><img style="float:left;margin-top:-14px;border:1px solid #ff9000;vertical-align: middle;" width="15px" height="15px" src="images/tick_.png"/>';
                                                            text = text + '</div>';
                                                            }
                                                            text = text + '<div class="clr"></div>';	
                                                            text = text + '<div id="div_items'+result.storeid+'"></div>';	
                                                            
                                                            
                                                            var splitname=(result.itname).split(",");
                                                           
                                                            var splitprice=(result.itprice).split(",");
                                                            var splitquantity=(result.itqty).split(",");
                                                            var splittax=(result.ittax).split(",");
                                                            var splitimage=(result.imgurl).split(",");
                                                          
                                                            for(var j=0;j<splitname.length;j++)
                                                            {
                                                            
                                                            var total =(splitprice[j] * splitquantity[j])*100/100;
                                                            var itemtax=((((splittax[j] * total)/100)*100)/100).toFixed(2);
                                                            var itemtotal= (((parseFloat(total) + parseFloat(itemtax))*100)/100).toFixed(2);
                                                            
                                                            
                                                            
                                                            var returnSuccess1 = new Array();
                                                            returnSuccess1[0] = splitimage[j];
                                                            
                                                            
                                                            
                                                            var store_url = splitimage[j].split('/');
                                                            var store_len = store_url.length;
                                                            var store_img = store_url[store_len - 1];
                                                            returnSuccess1[1] = store_img;
                                                            returnSuccess1[2] = s;
                                                            
                                                                                                                       text = text + '<div class="clr"></div>';
                                                            text = text + '<div style="float:left;" >';
                                                            text = text + '<img style="width:80px; height:80px;" id="out'+s+'" src="'+path_arr+'/'+store_img+'" />';
                                                            
                                                            
                                                           
                                                            
                                                            text = text + '</div>';
                                                            text = text + '<div  id="storeAddress" style="float:left;width:60%;padding-left:15px;white-space:nowrap;position:relative;">';
                                                            text = text + '<div  style="float:left;width:150px;line-height:35px;white-space:nowrap;margin-top:-12px;">';
                                                            text = text + '<span id="storeRestaurant1'+s+'" class="storeAddPopUpList" onclick="StoreAddressPopUp(this.id);" style="white-space:nowrap;">';
                                                            
                                                            text = text + '<span class="lab" style="position:relative;left:-5px;top:-2px;">'+splitname[j]+'</span>';
                                                            text = text + '</span>';
                                                            text = text + '</div>';
                                                            text = text +'<div class="clr"></div>';	
                                                            text = text + '<label class="blacktext" style="font-weight:normal;font-size:14px;font-family:Roboto;">';
                                                            text = text + '<table style="position: relative;top: -10px;">';
                                                            
                                                            text = text + '<tr>';
                                                            text = text + '<td>Unit Price:</td>';
                                                            text = text + '<td class="orangetextnavbar">$ '+splitprice[j]+'</td>';
                                                            text = text + '</tr>';
                                                            text = text + '<tr>';
                                                            text = text + '<td>Qty:</td>';
                                                            text = text + '<td class="orangetextnavbar">'+splitquantity[j]+'</td>';
                                                            text = text + '</tr>';
                                                            text = text + '<tr>';
                                                            text = text + '<td>Tax:</td>';
                                                            text = text + '<td class="orangetextnavbar">'+itemtax+'</td>';
                                                            text = text + '</tr>';
                                                            text = text + '<tr>';
                                                            text = text + '<td>Total:</td>';
                                                            text = text + '<td class="orangetextnavbar">$ '+itemtotal+'</td>';
                                                            text = text + '</tr>';
                                                            text = text + '</table>';
                                                            text = text + '</label>';
                                                            text = text + '</div>';
                                                            text = text + '<div class="clr"></div>';
                                                            s++;
                                                            
                                                            }
                                                            
                                                            
                                                            text = text + '</div>';
                                                            text = text + '</div>';
                                                            text = text + '<hr/>';
                                                            
                                                            document.getElementById('display_id').innerHTML = text;
                                                            $("#display_id").trigger("create");
                                                            
                                                            }
                                                            else{
                                                            
                                                            count_nonapplicable_date++;
                                                            
                                                            if(count_nonapplicable_date==len)
                                                            {
                                                            document.getElementById('display_id').innerHTML = "";
                                                            document.getElementById('display_id1').innerHTML = "";
                                                            text = text +'<div id="" class="divcolor" style="padding: 20px 20px; display: block; position: relative; top: -3px; border: 6px solid #e5e5e5">';
                                                            text = text +'<p>No Recent Orders Available</p>';
                                                            text = text +'</div>';
                                                            document.getElementById('display_id').innerHTML = text;
                                                            }
                                                            $('#loadTry').popup("close");
                                                            }
                                                            });
                                              
                                              }
                                                                                            }
                                              
                                              
                                              });
                                
                                });
		}

        
         var refreshcount=1;
		
		function get_recent_orderhistoryold()
		{
           
		
            
			var userID = localStorage.getItem('userid');
			
			
			var today = new Date();
			var todaydate = today.getFullYear() + "-" +("0" + ( today.getMonth() + 1)).slice(-2) + "-" +("0" +  today.getDate()).slice(-2);
			todaydate = new Date(todaydate);
			
			var monthback = new Date(today.getTime() - 30*24*60*60*1000);
			var lastback = monthback.getFullYear() + "-" +("0" + ( monthback.getMonth() + 1)).slice(-2) + "-" +("0" +  monthback.getDate()).slice(-2);
			lastback = new Date(lastback);
			
			
			
			 BUYDEMO.transaction(function(tx) {
			 tx.executeSql("SELECT * FROM customer_ordered_stores where customer_ordered_stores.customerid='"+userID+"'", [], function (tx, results) {
			var lenorder = results.rows.length;
			
			
				 
			
			
			var t=0;
			var s1=0;
			var p1=0;
			var count_nonapplicable_date=1;
			for(var n=0;n<lenorder;n++)
			{ 
			
			var result1 = results.rows.item(n);
				
				
				
				 tx.executeSql('SELECT customer_ordered_stores.*,customer_orders.*,customer_orders_items.*,GROUP_CONCAT(customer_orders_items.itemName) as itname,GROUP_CONCAT(customer_orders_items.price) as itprice,GROUP_CONCAT(customer_orders_items.quantity) as itqty,GROUP_CONCAT(customer_orders_items.taxRate) as ittax,GROUP_CONCAT(customer_orders_items.imageURL) as imgurl FROM customer_ordered_stores inner join customer_orders on customer_ordered_stores.storeid=customer_orders.mainstoreid inner join customer_orders_items on customer_orders_items.mainorderid=customer_orders.orderid where customer_orders.mainstoreid="'+result1.storeid+'" group by customer_orders.orderid', [], function (tx, results1) {
				 var len1 = results1.rows.length;
				 
				 var result = results1.rows.item(0);
				  
				 
				 var split_date=result.created_date.split("T"); 
				 var createdate=new Date(split_date[0]);
				 
				if((createdate >= lastback) && (createdate <= todaydate))
				{
				
				
				
				
				 for(var x=0;x<len1;x++)
				 {
				 var result = results1.rows.item(x);
				 
				 var splitdate=(result.created_date).split("T");
				
					var splitnameinner=(result.itname).split(",");
				
				 var splitpriceinner=(result.itprice).split(",");
				  var splitquantityinner=(result.itqty).split(",");
				  var splittaxinner=(result.ittax).split(",");
				
				 var splitimagein;
				  if(!result.imgurl || result.imgurl == null)
				  {
					splitimagein='images/no_image.png,'.split(",");
					
				  }
				  else
				  {
					splitimagein=(result.imgurl).split(",");
				  }
				 
					for(var k=0;k<splitnameinner.length;k++)
					{
					
							
							var total =(splitpriceinner[k] * splitquantityinner[k])*100/100;
					
							var itemtax=((((splittaxinner[k] * total)/100)*100)/100).toFixed(2);
							var itemtotal= (((parseFloat(total) + parseFloat(itemtax))*100)/100).toFixed(2);
							
							var store_url = splitimagein[k].split('/');
							
							var store_len = store_url.length;
							
							var store_imgin = store_url[store_len - 1];
							
							
							
							if(store_imgin=='' || store_imgin=='no_image.png')
							{
			        		
							}
							else
							{
                               var imgin = new Image();
                               var dsin = new Date();
                               var secin = dsin.getSeconds();
                               //document.getElementById("smallImage").src=path_arr+"/"+returnSuccess[1]+"?"+sec;
                               imgin.src = path_arr+'/'+store_imgin;
                               
                               if(!imgin.complete)
                               {
                               
                               }
                               else
                               {
                               
                               
                               document.getElementById("in"+p1).src = path_arr+'/'+store_imgin;
                               }
			        	
							
							
							}
			        			p1++;
						
							
			        }
				
					
				}
			

			

							var splitdate=(result.created_date).split("T");
			
			       
				 
				 var splitname=(result.itname).split(",");
			
				 var splitprice=(result.itprice).split(",");
				  var splitquantity=(result.itqty).split(",");
				  var splittax=(result.ittax).split(",");
				 
				  var splitimageout;
				  if(!result.imgurl)
				  {
					splitimageout='images/no_image.png,'.split(",");
				  }
				  else
				  {
					splitimageout=(result.imgurl).split(",");
				  }
				   for(var j=0;j<splitname.length;j++)
					{
				
					 var total =(splitprice[j] * splitquantity[j])*100/100;
					 var itemtax=((((splittax[j] * total)/100)*100)/100).toFixed(2);
					 var itemtotal= (((parseFloat(total) + parseFloat(itemtax))*100)/100).toFixed(2);
					 
					var store_url = splitimageout[j].split('/');
							var store_len = store_url.length;
							var store_imgout = store_url[store_len - 1];
							
							
					
							if(store_imgout=='no_image.png')
							{
			        		
							}
							else
							{
                               var imgout = new Image();
                               var dsout = new Date();
                               var secout = dsout.getSeconds();
                              
                               imgout.src = path_arr+'/'+store_imgout;
                              
                               if(!imgout.complete)
                               {
                               
                               }
                               else
                               {
                               
                               document.getElementById("out"+s1).src = path_arr+'/'+store_imgout;
                               }

							
								
							}
			        	s1++;
						
					}
					
                   
                               
				}
				else{
				
                               
				}
				});
                           
                           if(refreshcount == lenorder)
                           {
                           
                          
                           
                           }
                          
                           
                           refreshcount++;
				
				}
				
				});
				
				});
		}
    
    
	
	function display_div()
	{
		
				document.getElementById('display_id').innerHTML = text;
				$("#display_id").trigger("create");
				
	}
	
	function del_orderhistory_div(id)
	 
	 {
		
		 $(document).on( "collapse", "#test-collapsible1"+id, function( event, ui ){
			   document.getElementById('divhistory'+id).style.display="block";
			});

			$(document).on( "expand", "#test-collapsible1"+id, function( event, ui ){
			    document.getElementById('divhistory'+id).style.display="none";
			}); 
		 
	 }
	 
	 function StoreAddressPopUp(t){
						

					   if ($('#'+t).innerWidth()< $('#'+t)[0].scrollWidth) {
   							document.getElementById('transitionExampl').innerHTML = document.getElementById(t).innerHTML;
							$( '#transitionExampl' ).popup( "open" );
							}
						 
				}
	</script>
 </body>
</html>

